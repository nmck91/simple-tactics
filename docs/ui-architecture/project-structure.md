# Project Structure

**Based on**: Next.js 14+ App Router with static export, following framework conventions and PRD Story 1.1 requirements. Structure refined based on team feedback for testability, contributor onboarding, and future scalability.

```
simple-tactics/
├── app/
│   ├── layout.tsx                    # Root layout - theme provider, fonts, global state
│   ├── page.tsx                      # Home: Tactics Library Grid (2-col mobile, 3-4 col desktop)
│   ├── globals.css                   # Global styles, CSS variables for themes
│   └── tactic/
│       └── [id]/
│           └── page.tsx              # Tactic Detail View with Canvas animation
│
├── components/
│   ├── TacticCard.tsx                # Grid card - thumbnail, title, category badge
│   ├── FieldCanvas.tsx               # Canvas rendering - dual-size (420px / 182px)
│   ├── AnimationControls.tsx         # Play/Pause/Restart buttons
│   ├── ThemeToggle.tsx               # Superhero ↔ Professional switcher
│   ├── FormatTabBar.tsx              # 5v5 / 7v7 / 9v9 selector
│   ├── ExplanationCard.tsx           # Expandable card - kid-speak / tactical language
│   ├── PlayerCustomization.tsx       # Name assignment panel
│   ├── Button.tsx                    # Primary/Secondary button variants
│   └── TextInput.tsx                 # Player name input (15 char limit)
│
├── hooks/
│   ├── useTacticAnimation.ts         # Canvas animation state management
│   ├── useTheme.ts                   # Theme context consumer hook
│   ├── useFormat.ts                  # Format context consumer hook
│   └── useLocalStorage.ts            # Typed localStorage persistence
│
├── lib/
│   ├── field-rendering/
│   │   ├── canvas-renderer.ts        # Canvas field drawing utilities
│   │   ├── animation-engine.ts       # Framer Motion + Canvas animation logic
│   │   └── field-types.ts            # Field-specific TypeScript types
│   ├── tactics-loader.ts             # Load and parse tactics JSON from /public
│   ├── theme-context.tsx             # React Context for theme state (Superhero/Pro)
│   ├── format-context.tsx            # React Context for format state (5v5/7v7/9v9)
│   ├── motion.tsx                    # LazyMotion provider wrapper
│   └── types.ts                      # Global TypeScript interfaces (Tactic, Player, Theme)
│
├── public/
│   ├── data/
│   │   └── tactics/
│   │       ├── README.md             # How to add a tactic, JSON schema quick reference
│   │       ├── pressing/
│   │       │   ├── high-press.json   # High Press tactic (all 3 formats)
│   │       │   └── counter-press.json
│   │       ├── passing/
│   │       │   ├── build-up.json
│   │       │   └── switch-play.json
│   │       ├── defending/
│   │       │   ├── compact-defense.json
│   │       │   └── zonal-marking.json
│   │       └── set-pieces/
│   │           ├── corner-kick.json
│   │           └── goal-kick.json
│   ├── icons/
│   │   ├── superhero/                # Character icons (Rocket Racer, Brick Wall, etc.)
│   │   │   ├── forward.svg
│   │   │   ├── midfielder.svg
│   │   │   └── defender.svg
│   │   └── professional/             # Jersey number icons
│   │       ├── player-1.svg
│   │       ├── player-2.svg
│   │       └── player-9.svg
│   ├── images/
│   │   ├── field-texture.webp        # Professional mode grass texture (optional)
│   │   └── logo.svg                  # App logo
│   ├── manifest.json                 # PWA manifest (installability)
│   ├── service-worker.js             # Generated by next-pwa
│   └── favicon.ico
│
├── styles/
│   └── themes.css                    # CSS variables for Superhero/Professional themes
│
├── __tests__/
│   ├── components/
│   │   ├── TacticCard.test.tsx
│   │   ├── FieldCanvas.test.tsx
│   │   └── ThemeToggle.test.tsx
│   ├── lib/
│   │   ├── tactics-loader.test.ts
│   │   └── field-rendering/
│   │       ├── canvas-renderer.test.ts
│   │       └── animation-engine.test.ts
│   ├── integration/
│   │   ├── tactic-selection.test.tsx  # Epic 2, Story 2.7
│   │   └── theme-switching.test.tsx
│   └── fixtures/
│       ├── high-press.json            # Minimal test tactic
│       ├── invalid-tactic.json        # For error handling tests
│       └── mock-player-positions.json
│
├── __mocks__/
│   ├── tactics.ts                     # Mock tactics data for tests
│   ├── localStorage.ts                # Mock Web Storage API
│   └── canvas.ts                      # Mock Canvas API for JSDOM tests
│
├── scripts/
│   ├── validate-tactics.js            # Pre-commit hook - validate all JSON schemas
│   ├── bundle-report.js               # Generate bundle size analysis
│   └── optimize-images.js             # Compress SVGs and WebP images
│
├── .github/
│   ├── workflows/
│   │   ├── ci.yml                     # Lint, test, build, Lighthouse CI
│   │   └── deploy.yml                 # Auto-deploy to Vercel on merge
│   ├── dependabot.yml                 # Security updates
│   └── PULL_REQUEST_TEMPLATE.md
│
├── docs/
│   ├── prd.md                         # Product Requirements
│   ├── ui-architecture.md             # This document
│   ├── front-end-spec.md              # UX specification
│   └── tactics/
│       └── SCHEMA.md                  # Tactics JSON schema documentation
│
├── .eslintrc.json                     # ESLint config (Next.js preset)
├── .prettierrc                        # Prettier config + Tailwind plugin
├── .husky/                            # Git hooks (pre-commit linting)
│   └── pre-commit                     # Run lint + validate-tactics.js
├── jest.config.js                     # Jest + next/jest config
├── jest.setup.js                      # Test environment setup (Canvas mock)
├── next.config.js                     # Next.js static export config
├── tailwind.config.ts                 # Tailwind theme customization
├── tsconfig.json                      # TypeScript strict mode config
├── package.json
├── package-lock.json
├── .gitignore
├── README.md
├── CONTRIBUTING.md
├── LICENSE (MIT)
└── CODE_OF_CONDUCT.md
```

---

## Key Structure Decisions

**1. Tactics JSON in `/public/data/tactics` (Not `/data`)**

**Rationale:**
- **Served as static assets** - Next.js serves `/public` files directly, not bundled with JavaScript
- **Bundle size savings** - Keeps ~150KB tactics data out of initial JS bundle
- **Dynamic loading** - Tactics fetched on-demand via `fetch('/data/tactics/high-press.json')`
- **CDN caching** - Hosting providers cache `/public` files on edge network

**Impact:** Reduces initial bundle from 1,015KB → 865KB ✅

---

**2. `/hooks` Directory for Custom React Hooks**

**Standard React pattern for reusable stateful logic:**

```tsx
// hooks/useTacticAnimation.ts
export function useTacticAnimation(tactic: Tactic) {
  const [isPlaying, setIsPlaying] = useState(false)
  const [progress, setProgress] = useState(0)

  const play = () => setIsPlaying(true)
  const pause = () => setIsPlaying(false)
  const restart = () => { setProgress(0); setIsPlaying(true) }

  return { isPlaying, progress, play, pause, restart }
}

// hooks/useTheme.ts
export function useTheme() {
  const context = useContext(ThemeContext)
  if (!context) throw new Error('useTheme must be used within ThemeProvider')
  return context
}
```

**Expected Hooks:**
- `useTacticAnimation` - Animation state (play/pause/restart)
- `useTheme` - Theme context consumer (Superhero/Professional)
- `useFormat` - Format context consumer (5v5/7v7/9v9)
- `useLocalStorage` - Typed localStorage with SSR safety

---

**3. `/lib/field-rendering/` Subdirectory for Co-Located Code**

**Problem:** `canvas-renderer.ts` and `animation-engine.ts` are tightly coupled - both work with Canvas API

**Solution:** Group related modules in subdirectory

```
/lib/field-rendering/
  canvas-renderer.ts    # Draw field, players, ball
  animation-engine.ts   # Animate player movements
  field-types.ts        # FieldDimensions, PlayerPosition types
```

**Benefits:**
- Related code stays together (easier maintenance)
- Clear module boundaries (field rendering vs tactics loading vs theme management)
- Scalable pattern (add `/lib/storage/` for localStorage utilities later)

---

**4. `/__mocks__` and `/__tests__/fixtures` for Testing Infrastructure**

**Critical for Epic 1, Story 1.6 (Unit Tests):**

**`__mocks__/canvas.ts`** - Mock Canvas API (doesn't exist in JSDOM):
```ts
export const mockCanvas = {
  getContext: jest.fn(() => ({
    fillRect: jest.fn(),
    clearRect: jest.fn(),
    drawImage: jest.fn(),
    // ... all Canvas 2D methods
  })),
}

HTMLCanvasElement.prototype.getContext = mockCanvas.getContext
```

**`__tests__/fixtures/high-press.json`** - Minimal test tactic:
```json
{
  "id": "test-tactic",
  "title": "Test Tactic",
  "category": "pressing",
  "formats": {
    "5v5": { "positions": [...] }
  }
}
```

**Without these:** Every `FieldCanvas` test fails with "getContext is not a function"

---

**5. `/scripts` Directory for Developer Automation**

**`scripts/validate-tactics.js`** - Run in pre-commit hook:
```js
// Validates all tactics JSON against schema
// Fails commit if invalid tactic detected
const tactics = loadAllTactics()
tactics.forEach(tactic => {
  if (!validateSchema(tactic)) {
    console.error(`Invalid tactic: ${tactic.id}`)
    process.exit(1)
  }
})
```

**`scripts/bundle-report.js`** - Analyze build size:
```js
// Generate visual bundle size report
// Run after `npm run build`
import analyzer from 'webpack-bundle-analyzer'
analyzer.start('./dist')
```

**`scripts/optimize-images.js`** - Compress assets:
```js
// Optimize all SVGs and WebP images
// Run before committing new icons
import { optimize } from 'svgo'
optimizeDirectory('./public/icons')
```

---

## File Naming Conventions

**TypeScript/React Files:**
- Components: `PascalCase.tsx` (e.g., `TacticCard.tsx`)
- Hooks: `use + PascalCase.ts` (e.g., `useTheme.ts`)
- Utilities: `kebab-case.ts` (e.g., `tactics-loader.ts`)
- Contexts: `kebab-case.tsx` (e.g., `theme-context.tsx`)
- Tests: `SourceName.test.tsx` or `source-name.test.ts`

**Data Files:**
- Tactics: `kebab-case.json` (e.g., `high-press.json`)
- Tactic IDs match filenames: `"id": "high-press"` → `high-press.json`

**Assets:**
- Icons: `kebab-case.svg` (e.g., `player-1.svg`, `forward.svg`)
- Images: `kebab-case.webp` (WebP format for optimization)

**Scripts:**
- Node scripts: `kebab-case.js` (e.g., `validate-tactics.js`)

---

## Import Path Aliases

**tsconfig.json configuration:**

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"],
      "@/components/*": ["./components/*"],
      "@/hooks/*": ["./hooks/*"],
      "@/lib/*": ["./lib/*"]
    }
  }
}
```

**Usage Examples:**
```tsx
// Clean imports from anywhere in the codebase
import { TacticCard } from '@/components/TacticCard'
import { useTheme } from '@/hooks/useTheme'
import { loadTactics } from '@/lib/tactics-loader'
import { drawField } from '@/lib/field-rendering/canvas-renderer'
```

---

## Next.js App Router Patterns

**1. Root Layout with Providers (app/layout.tsx)**

```tsx
import { ThemeProvider } from '@/lib/theme-context'
import { FormatProvider } from '@/lib/format-context'
import MotionProvider from '@/lib/motion'
import '@/app/globals.css'

export const metadata = {
  title: 'Simple Tactics',
  description: 'Interactive tactics for youth soccer coaches',
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <ThemeProvider>
          <FormatProvider>
            <MotionProvider>
              {children}
            </MotionProvider>
          </FormatProvider>
        </ThemeProvider>
      </body>
    </html>
  )
}
```

**2. Home Page - Tactics Grid (app/page.tsx)**

```tsx
import { TacticCard } from '@/components/TacticCard'
import { ThemeToggle } from '@/components/ThemeToggle'
import { FormatTabBar } from '@/components/FormatTabBar'

// This data is fetched at build time (static export)
async function getTactics() {
  // In static export mode, this reads from /public during build
  const res = await fetch('/data/tactics/index.json')
  return res.json()
}

export default async function HomePage() {
  const tactics = await getTactics()

  return (
    <main className="container mx-auto px-4 py-8">
      <header className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold">Simple Tactics</h1>
        <ThemeToggle />
      </header>

      <FormatTabBar />

      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6">
        {tactics.map(tactic => (
          <TacticCard key={tactic.id} tactic={tactic} />
        ))}
      </div>
    </main>
  )
}
```

**3. Dynamic Route - Tactic Detail (app/tactic/[id]/page.tsx)**

```tsx
import { FieldCanvas } from '@/components/FieldCanvas'
import { ExplanationCard } from '@/components/ExplanationCard'

async function getTactic(id: string) {
  const res = await fetch(`/data/tactics/${id}.json`)
  if (!res.ok) throw new Error('Tactic not found')
  return res.json()
}

export default async function TacticDetailPage({ params }: { params: { id: string } }) {
  const tactic = await getTactic(params.id)

  return (
    <div className="h-screen flex flex-col">
      <FieldCanvas tactic={tactic} />
      <ExplanationCard tactic={tactic} />
    </div>
  )
}

// Generate static paths for all tactics at build time
export async function generateStaticParams() {
  const tactics = await fetch('/data/tactics/index.json').then(r => r.json())
  return tactics.map((tactic) => ({ id: tactic.id }))
}
```

---

## Critical Configuration Files

**jest.setup.js - Canvas Mock (Required for Tests):**

```js
// Mock Canvas API for JSDOM environment
HTMLCanvasElement.prototype.getContext = jest.fn(() => ({
  fillRect: jest.fn(),
  clearRect: jest.fn(),
  fillStyle: '',
  strokeStyle: '',
  lineWidth: 1,
  beginPath: jest.fn(),
  moveTo: jest.fn(),
  lineTo: jest.fn(),
  arc: jest.fn(),
  stroke: jest.fn(),
  fill: jest.fn(),
}))

// Mock IntersectionObserver (used by Framer Motion)
global.IntersectionObserver = class IntersectionObserver {
  observe() {}
  unobserve() {}
  disconnect() {}
}
```

**Husky pre-commit hook (.husky/pre-commit):**

```bash
#!/bin/sh
npm run lint
npm run validate-tactics  # Runs scripts/validate-tactics.js
```

---

## Scalability Plan (Post-MVP)

**When to refactor structure:**

| Threshold | Current | Action |
|-----------|---------|--------|
| **15+ components** | 10 components (MVP) | Move to `/components/[feature]` subdirectories |
| **3+ context providers** | 2 providers (theme, format) | Create dedicated `/contexts` directory |
| **10+ utilities in `/lib`** | ~6 utilities | Create subdirectories by domain |

**Migration path documented in README.md:**

```markdown
# Project Structure Evolution

## Current (MVP)
- Flat `/components` (10 components)
- Single `/lib` with `/field-rendering` subdirectory

## Phase 2 (15+ components)
- Feature-based: `/components/field`, `/components/cards`, `/components/controls`
- Dedicated `/contexts` directory

## Phase 3 (Backend features)
- Add `/app/api` routes (Next.js API)
- Add `/services` for external API calls
```

---
